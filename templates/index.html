{% extends "base.html" %}

{% block content %}
<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-0">
            <i data-feather="activity" class="me-2"></i>
            Saskatchewan Hospital Emergency Department Monitor
        </h1>
        <p class="text-muted mb-0">
            Live patient counts from eHealth Saskatchewan PDF reports
            <a href="https://www.ehealthsask.ca/reporting/Documents/SaskatoonHospitalBedCapacity.pdf" target="_blank" class="ms-2" aria-label="View eHealth Saskatchewan PDF report in new tab">
                <i data-feather="external-link" style="width: 14px; height: 14px;"></i>
            </a>
        </p>
    </div>
    <div>
        <a href="/history" class="btn btn-outline-secondary me-2">
            <i data-feather="clock" class="me-2"></i>
            Historical Data
        </a>
        <button id="refresh-btn" class="btn btn-outline-primary" onclick="refreshData()">
            <i data-feather="refresh-cw" class="me-1"></i>
            Refresh
        </button>
    </div>
</div>

<!-- Status Alert -->
<div class="alert alert-info d-flex align-items-center mb-4" role="alert">
    <i data-feather="info" class="me-2"></i>
    <div>
        <strong>Data Source:</strong> Automated extraction from eHealth Saskatchewan Emergency Department reports. 
        Updates every 30 minutes when new data is published.
    </div>
</div>

<!-- Hospital Cards -->
<div class="row g-4 mb-4">
    <!-- Royal University Hospital -->
    <div class="col-lg-3">
        <div class="card h-100">
            <div class="card-header d-flex align-items-center">
                <i data-feather="home" class="me-2"></i>
                <h5 class="mb-0">Royal University Hospital</h5>
            </div>
            <div class="card-body text-center" aria-live="polite">
                <h1 class="display-4 mb-2" id="ruh-total-patients">-</h1>
                <p class="text-muted mb-0">Emergency Department Patients</p>
                <small class="text-muted" id="ruh-time">Loading...</small>
            </div>
        </div>
    </div>

    <!-- St. Paul's Hospital -->
    <div class="col-lg-3">
        <div class="card h-100">
            <div class="card-header d-flex align-items-center">
                <i data-feather="home" class="me-2"></i>
                <h5 class="mb-0">St. Paul's Hospital</h5>
            </div>
            <div class="card-body text-center" aria-live="polite">
                <h1 class="display-4 mb-2" id="sph-total-patients">-</h1>
                <p class="text-muted mb-0">Emergency Department Patients</p>
                <small class="text-muted" id="sph-time">Loading...</small>
            </div>
        </div>
    </div>

    <!-- Saskatoon City Hospital -->
    <div class="col-lg-3">
        <div class="card h-100">
            <div class="card-header d-flex align-items-center">
                <i data-feather="home" class="me-2"></i>
                <h5 class="mb-0">Saskatoon City Hospital</h5>
            </div>
            <div class="card-body text-center" aria-live="polite">
                <h1 class="display-4 mb-2" id="sch-total-patients">-</h1>
                <p class="text-muted mb-0">Emergency Department Patients</p>
                <small class="text-muted" id="sch-time">Loading...</small>
            </div>
        </div>
    </div>

    <!-- Jim Pattison Children's Hospital -->
    <div class="col-lg-3">
        <div class="card h-100">
            <div class="card-header d-flex align-items-center">
                <i data-feather="home" class="me-2"></i>
                <h5 class="mb-0">Jim Pattison Children's Hospital</h5>
            </div>
            <div class="card-body text-center" aria-live="polite">
                <h1 class="display-4 mb-2" id="jpch-total-patients">-</h1>
                <p class="text-muted mb-0">Emergency Department Patients</p>
                <small class="text-muted" id="jpch-time">Loading...</small>
            </div>
        </div>
    </div>
</div>



<!-- Status Section -->
<div class="row g-4 mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex align-items-center">
                <i data-feather="clock" class="me-2"></i>
                <h5 class="mb-0">System Status</h5>
            </div>
            <div class="card-body" aria-live="polite">
                <div id="status-content">
                    <p class="text-muted">Loading system status...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weather Section -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header d-flex align-items-center">
                <i data-feather="cloud" class="me-2"></i>
                <h5 class="mb-0">Current Weather</h5>
            </div>
            <div class="card-body" aria-live="polite">
                <div id="weather-content">
                    <p class="text-muted">Loading weather data...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }} {# Assuming base.html might have scripts, good practice to include them #}
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}