{% extends "base.html" %}

{% block title %}Medical Clinics - Saskatoon Healthcare{% endblock %}

{% block content %}
<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="display-6">Medical Clinics in Saskatoon</h1>
        <p class="text-muted">Find open medical clinics and walk-in centers near you</p>
    </div>
    <a href="/" class="btn btn-outline-secondary">
        <i data-feather="arrow-left" class="me-2"></i>
        Back to Dashboard
    </a>
</div>

<!-- Loading State -->
<div id="loading-state" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading clinics...</span>
    </div>
    <p class="mt-3 text-muted">Finding open medical clinics in Saskatoon...</p>
</div>

<!-- Error State -->
<div id="error-state" class="alert alert-warning d-none" role="alert">
    <i data-feather="alert-triangle" class="me-2"></i>
    <span id="error-message">Unable to load clinic information. Please check your internet connection.</span>
</div>

<!-- Clinics Grid -->
<div id="clinics-container" class="row g-4 d-none">
    <!-- Clinic cards will be populated here -->
</div>

<!-- No Results -->
<div id="no-results" class="text-center py-5 d-none">
    <i data-feather="map-pin" class="text-muted mb-3" style="width: 48px; height: 48px;"></i>
    <h3 class="text-muted">No Open Clinics Found</h3>
    <p class="text-muted">No medical clinics are currently showing as open in Saskatoon.</p>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    feather.replace();
    loadClinics();
});

async function loadClinics() {
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const clinicsContainer = document.getElementById('clinics-container');
    const noResults = document.getElementById('no-results');
    
    try {
        const response = await fetch('/api/medical-clinics');
        const data = await response.json();
        
        loadingState.classList.add('d-none');
        
        if (data.success && data.clinics && data.clinics.length > 0) {
            displayClinics(data.clinics);
            clinicsContainer.classList.remove('d-none');
        } else {
            noResults.classList.remove('d-none');
            if (data.error) {
                document.getElementById('error-message').textContent = data.error;
                errorState.classList.remove('d-none');
                noResults.classList.add('d-none');
            }
        }
    } catch (error) {
        loadingState.classList.add('d-none');
        errorState.classList.remove('d-none');
        document.getElementById('error-message').textContent = 'Failed to load clinic information.';
    }
}

function displayClinics(clinics) {
    const container = document.getElementById('clinics-container');
    container.innerHTML = '';
    
    clinics.forEach(clinic => {
        const clinicCard = createClinicCard(clinic);
        container.appendChild(clinicCard);
    });
}

function createClinicCard(clinic) {
    const col = document.createElement('div');
    col.className = 'col-md-6 col-lg-4';
    
    const isOpen = clinic.isOpen ? 'Open' : 'Closed';
    const openClass = clinic.isOpen ? 'text-success' : 'text-danger';
    const rating = clinic.rating ? `â˜… ${clinic.rating}` : 'No rating';
    const phone = clinic.phone || 'Phone not available';
    const address = clinic.address || 'Address not available';
    
    col.innerHTML = `
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title">${clinic.name}</h5>
                    <span class="badge rounded-pill ${clinic.isOpen ? 'bg-success' : 'bg-danger'}">
                        ${isOpen}
                    </span>
                </div>
                
                <div class="mb-2">
                    <small class="text-muted">
                        <i data-feather="map-pin" class="me-1" style="width: 14px; height: 14px;"></i>
                        ${address}
                    </small>
                </div>
                
                <div class="mb-2">
                    <small class="text-muted">
                        <i data-feather="phone" class="me-1" style="width: 14px; height: 14px;"></i>
                        ${phone}
                    </small>
                </div>
                
                <div class="mb-3">
                    <small class="text-warning">
                        <i data-feather="star" class="me-1" style="width: 14px; height: 14px;"></i>
                        ${rating}
                    </small>
                </div>
                
                ${clinic.hours ? `
                    <div class="mb-2">
                        <small class="text-muted">
                            <i data-feather="clock" class="me-1" style="width: 14px; height: 14px;"></i>
                            ${clinic.hours}
                        </small>
                    </div>
                ` : ''}
                
                <div class="d-flex gap-2">
                    ${clinic.website ? `
                        <a href="${clinic.website}" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i data-feather="external-link" class="me-1" style="width: 14px; height: 14px;"></i>
                            Website
                        </a>
                    ` : ''}
                    
                    ${clinic.directions ? `
                        <a href="${clinic.directions}" target="_blank" class="btn btn-outline-secondary btn-sm">
                            <i data-feather="navigation" class="me-1" style="width: 14px; height: 14px;"></i>
                            Directions
                        </a>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
    
    // Replace feather icons in the newly created element
    setTimeout(() => feather.replace(), 0);
    
    return col;
}
</script>
{% endblock %}